generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum UserRole {
  CUSTOMER
  OWNER
  ADMIN
}

enum BookingStatus {
  PENDING
  CONFIRMED
  CANCELLED
  COMPLETED
}

model User {
  id           String   @id @default(uuid())
  email        String   @unique
  passwordHash String
  firstName    String
  lastName     String
  phone        String?
  role         UserRole @default(CUSTOMER)
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  // Relations
  restaurants Restaurant[] @relation("RestaurantOwner")
  bookings    Booking[]
  reviews     Review[]

  @@index([email])
  @@index([role])
  @@map("users")
}

model Restaurant {
  id            String   @id @default(uuid())
  name          String
  description   String?
  address       String
  city          String
  phone         String
  cuisineType   String
  priceRange    Int // 1-4 scale
  photos        String[] // Array of photo URLs
  openingHours  Json // JSON object for weekly hours
  ownerId       String
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  // Relations
  owner    User      @relation("RestaurantOwner", fields: [ownerId], references: [id], onDelete: Cascade)
  tables   Table[]
  bookings Booking[]
  reviews  Review[]

  @@index([ownerId])
  @@index([city])
  @@index([cuisineType])
  @@index([priceRange])
  @@map("restaurants")
}

model Table {
  id          String  @id @default(uuid())
  restaurantId String
  tableNumber String
  capacity    Int
  isActive    Boolean @default(true)

  // Relations
  restaurant Restaurant  @relation(fields: [restaurantId], references: [id], onDelete: Cascade)
  bookings   Booking[]

  @@index([restaurantId])
  @@index([isActive])
  @@unique([restaurantId, tableNumber])
  @@map("tables")
}

model Booking {
  id             String        @id @default(uuid())
  userId         String
  restaurantId   String
  tableId        String
  date           DateTime      @db.Date
  time           String        // HH:MM format
  partySize      Int
  status         BookingStatus @default(PENDING)
  specialRequests String?
  createdAt      DateTime      @default(now())
  updatedAt      DateTime      @updatedAt

  // Relations
  user       User       @relation(fields: [userId], references: [id], onDelete: Cascade)
  restaurant Restaurant @relation(fields: [restaurantId], references: [id], onDelete: Cascade)
  table      Table      @relation(fields: [tableId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([restaurantId])
  @@index([tableId])
  @@index([date])
  @@index([status])
  @@index([userId, status])
  @@index([restaurantId, date])
  @@map("bookings")
}

model Review {
  id           String   @id @default(uuid())
  userId       String
  restaurantId String
  rating       Int      @db.SmallInt // 1-5 scale
  comment      String?
  createdAt    DateTime @default(now())

  // Relations
  user       User       @relation(fields: [userId], references: [id], onDelete: Cascade)
  restaurant Restaurant @relation(fields: [restaurantId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([restaurantId])
  @@index([rating])
  @@unique([userId, restaurantId])
  @@map("reviews")
}
